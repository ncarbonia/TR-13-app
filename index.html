<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="theme-color" content="#146bb5" />

  <link rel="manifest" href="./manifest.webmanifest" />
  <link rel="icon" href="data:," />
  <title>Big G Steel LLC - TR-13 Crane Tolerance Checker</title>

  <link rel="stylesheet" href="./style.css" />
</head>

<body>
  <header class="pageHeader">
    <div class="titleStack">
      <div class="titleLine">Big G Steel LLC</div>
      <div class="titleLine">Overhead Crane Installation Tolerance Checker</div>
      <div class="titleLine">TR-13 / CMAA Field Check</div>
    </div>
  </header>

  <main class="container">

    <section class="card">
      <h2>Project Details</h2>

      <div class="grid two-col">
        <label class="field">
          <span class="labelText">Project name</span>
          <input id="projectName" type="text" placeholder="Plant A - Runway Line 2" />
        </label>

        <label class="field">
          <span class="labelText">Spec profile</span>
          <select id="profileSelect"></select>
        </label>
      </div>
    </section>

    <section class="card">
      <h2>Column Layout &amp; Station Setup</h2>

      <div class="grid three-col">
        <label class="field">
          <span class="labelText">Columns per side</span>
          <input id="columnsPerSide" type="number" min="2" value="3" />
        </label>

        <label class="field">
          <span class="labelText">Measured station distance (ft)</span>
          <input id="measuredStationDistance" type="number" min="1" value="10" />
        </label>

        <label class="field">
          <span class="labelText">Direction labels for side pair</span>
          <select id="directionPair">
            <option value="North|South">North / South</option>
            <option value="East|West">East / West</option>
          </select>
        </label>
      </div>

      <div class="actions">
        <button id="buildLayout" class="btn secondary" type="button">Build Column Layout</button>
      </div>

      <div id="layoutContainer" class="stack"></div>

      <p class="subtle">
        Enter designed and actual column-to-column distances. The app uses measured station distance to generate station points.
      </p>
    </section>

    <section class="card">
      <h2>Measurements</h2>
      <form id="measurementForm" class="formList"></form>

      <div class="actions">
        <button id="runCheck" class="btn primary" type="button">Run Compliance Check</button>
      </div>
    </section>

    <!-- NEW: Station-by-station straightness & eccentricity inputs -->
    <section class="card">
      <h2>Straightness &amp; Eccentricity Survey (Station-by-Station)</h2>

      <p class="subtle">
        Stations auto-populate. Enter <strong>horizontal offsets</strong> in inches at each station.
        This produces straightness and eccentricity charts (survey-style) plus PASS/FAIL.
      </p>

      <div class="grid three-col">
        <label class="field">
          <span class="labelText">Runway length (ft)</span>
          <input id="surveyRunwayLengthFt" type="number" step="any" value="200" />
        </label>

        <label class="field">
          <span class="labelText">Station spacing (ft)</span>
          <input id="surveyStationSpacingFt" type="number" step="any" value="10" />
        </label>

        <label class="field">
          <span class="labelText">Start station (ft)</span>
          <input id="surveyStartFt" type="number" step="any" value="0" />
        </label>
      </div>

      <div class="grid three-col">
        <label class="field">
          <span class="labelText">Straightness tolerance window (Â± in)</span>
          <input id="surveyStraightTol" type="number" step="any" value="0.375" />
        </label>

        <label class="field">
          <span class="labelText">Max rate of change (in per 20 ft)</span>
          <input id="surveyRateTolPer20" type="number" step="any" value="0.25" />
        </label>

        <label class="field">
          <span class="labelText">Enable beam inputs (eccentricity)</span>
          <select id="surveyUseBeam">
            <option value="no" selected>No (straightness only)</option>
            <option value="yes">Yes (straightness + eccentricity)</option>
          </select>
        </label>
      </div>

      <details class="subtle" style="margin-top:10px;">
        <summary><strong>Eccentricity tolerance zones (optional)</strong></summary>
        <p style="margin-top:8px;">
          One zone per line: <code>StartFt,EndFt,ToleranceIn</code>
        </p>
        <textarea id="eccZones" rows="5">0,300,0.630
300,325,0.454
325,465,0.765
465,700,0.630</textarea>
      </details>

      <div class="actions">
        <button id="buildSurveyStations" class="btn secondary" type="button">Build Stations</button>
        <button id="evaluateSurvey" class="btn primary" type="button">Evaluate &amp; Render</button>
      </div>

      <div id="surveyStatus" class="summary">No survey table built yet.</div>

      <div class="tableWrap" style="margin-top:12px;">
        <table id="surveyTable" aria-label="Survey station inputs">
          <thead>
            <tr>
              <th>Station (ft)</th>
              <th>Rail N (in)</th>
              <th>Rail S (in)</th>
              <th class="beamCol">Beam N (in)</th>
              <th class="beamCol">Beam S (in)</th>
              <th>N Status</th>
              <th>S Status</th>
              <th>Rate N</th>
              <th>Rate S</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>

      <div class="stack" style="gap:16px; margin-top:12px;">
        <div class="svgFrame">
          <svg id="straightnessSvg" width="1100" height="360" viewBox="0 0 1100 360" role="img" aria-label="Straightness plot"></svg>
        </div>

        <div class="svgFrame">
          <svg id="eccentricitySvg" width="1100" height="360" viewBox="0 0 1100 360" role="img" aria-label="Eccentricity plot"></svg>
        </div>
      </div>
    </section>

    <section class="card">
      <h2>Results</h2>

      <div id="summary" class="summary">No check run yet.</div>

      <div class="actions split">
        <button id="exportPdf" class="btn secondary" type="button">Export Results to PDF</button>
      </div>

      <div class="tableWrap">
        <table id="resultTable" aria-label="Compliance results">
          <thead>
            <tr>
              <th>Check</th>
              <th>Measured</th>
              <th>Allowed</th>
              <th>Status</th>
              <th>Reference</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>

      <div id="suggestions" class="suggestions">
        <h3>Engineering Adjustment Suggestions</h3>
        <ul id="suggestionList">
          <li>Run a compliance check to generate adjustment guidance.</li>
        </ul>
      </div>
    </section>

    <footer class="footnote">
      <strong>Important:</strong> Field aid only. Validate limits against the latest CMAA 70 / 74, TR-13, and project specs.
    </footer>

  </main>

  <script src="./app.js"></script>
  <script>
    if ("serviceWorker" in navigator) {
      window.addEventListener("load", () => {
        navigator.serviceWorker.register("./sw.js").catch(console.error);
      });
    }
  </script>
</body>
</html>
