<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="theme-color" content="#146bb5">

  <link rel="manifest" href="./manifest.webmanifest">
  <link rel="icon" href="data:,">
  <title>Big G Steel LLC - TR-13 Crane Tolerance Checker</title>

  <link rel="stylesheet" href="./style.css">
</head>

<body>
  <header class="pageHeader">
    <div class="titleStack">
      <div class="titleLine">Big G Steel LLC</div>
      <div class="titleLine">Overhead Crane Installation Tolerance Checker</div>
      <div class="titleLine">TR-13 / CMAA Field Check</div>
    </div>
  </header>

  <main class="container">

    <section class="card">
      <h2>Project Details</h2>

      <div class="grid two-col">
        <label class="field">
          <span class="labelText">Project name</span>
          <input id="projectName" type="text" placeholder="Plant A - Runway Line 2">
        </label>

        <label class="field">
          <span class="labelText">Spec profile</span>
          <select id="profileSelect"></select>
        </label>
      </div>
    </section>

    <section class="card">
      <h2>Column Layout &amp; Station Setup</h2>

      <div class="grid three-col">
        <label class="field">
          <span class="labelText">Columns per side</span>
          <input id="columnsPerSide" type="number" min="2" value="3">
        </label>

        <label class="field">
          <span class="labelText">Measured station distance (ft)</span>
          <input id="measuredStationDistance" type="number" min="1" value="10">
        </label>

        <label class="field">
          <span class="labelText">Direction labels for side pair</span>
          <select id="directionPair">
            <option value="North|South">North / South</option>
            <option value="East|West">East / West</option>
          </select>
        </label>
      </div>

      <div class="actions">
        <button id="buildLayout" class="btn secondary" type="button">Build Column Layout</button>
      </div>

      <div id="layoutContainer" class="stack"></div>

      <p class="subtle">
        Enter designed and actual column-to-column distances. The app uses measured station distance to generate station points.
      </p>
    </section>

    <section class="card">
      <h2>Measurements</h2>
      <form id="measurementForm" class="formList"></form>

      <div class="actions">
        <button id="runCheck" class="btn primary" type="button">Run Compliance Check</button>
      </div>
    </section>

    <!-- NEW: Survey Import + Charts -->
    <section class="card">
      <h2>Straightness &amp; Eccentricity Survey (Station-by-Station)</h2>

      <p class="subtle">
        Paste station-by-station offsets. This produces report-style plots like a rail survey.
        Units: station in <strong>ft</strong>, offsets in <strong>inches</strong>.
      </p>

      <div class="grid two-col">
        <label class="field">
          <span class="labelText">Straightness tolerance window (± in)</span>
          <input id="surveyStraightTol" type="number" step="any" value="0.375">
        </label>

        <label class="field">
          <span class="labelText">Max allowable rate of change (in per 20 ft)</span>
          <input id="surveyRateTolPer20" type="number" step="any" value="0.25">
        </label>
      </div>

      <details class="subtle" style="margin-top:10px;">
        <summary><strong>Expected CSV format (copy/paste from Excel)</strong></summary>
        <p style="margin:10px 0 0;">
          Header row required. Use these column names (case-insensitive):
        </p>
        <pre style="white-space:pre-wrap; font-size:12px; margin-top:8px; padding:10px; border:1px solid #ddd; border-radius:10px;">
StationFt,RailN,RailS,BeamN,BeamS
0,0.05,-0.02,0.00,0.01
10,0.10,-0.01,0.02,0.00
20,0.12,0.03,0.03,0.02
...
        </pre>
        <p style="margin-top:8px;">
          If you don’t have BeamN/BeamS yet, you can still generate the straightness plots (eccentricity requires beam + rail).
        </p>
      </details>

      <label class="field" style="margin-top:12px;">
        <span class="labelText">Paste CSV data</span>
        <textarea id="surveyCsv" rows="10" placeholder="StationFt,RailN,RailS,BeamN,BeamS&#10;0,0.05,-0.02,0.00,0.01&#10;10,0.10,-0.01,0.02,0.00"></textarea>
      </label>

      <div class="actions">
        <button id="parseSurvey" class="btn secondary" type="button">Parse &amp; Render Survey Charts</button>
        <button id="clearSurvey" class="btn secondary" type="button">Clear Survey Data</button>
      </div>

      <div id="surveyStatus" class="summary">No survey data parsed yet.</div>

      <div class="stack" style="gap:16px; margin-top:12px;">
        <div style="overflow:auto; border:1px solid #e5e7eb; border-radius:12px; padding:12px;">
          <svg id="straightnessSvg" width="1100" height="360" viewBox="0 0 1100 360" role="img" aria-label="Straightness plot"></svg>
        </div>

        <div style="overflow:auto; border:1px solid #e5e7eb; border-radius:12px; padding:12px;">
          <svg id="eccentricitySvg" width="1100" height="360" viewBox="0 0 1100 360" role="img" aria-label="Eccentricity plot"></svg>
        </div>

        <details class="subtle">
          <summary><strong>Eccentricity tolerance zones (optional)</strong></summary>
          <p style="margin-top:8px;">
            Paste zones as CSV: <code>StartFt,EndFt,ToleranceIn</code> (one per line). Example:
          </p>
          <pre style="white-space:pre-wrap; font-size:12px; margin-top:8px; padding:10px; border:1px solid #ddd; border-radius:10px;">
0,300,0.630
300,325,0.454
325,465,0.765
465,700,0.630
          </pre>

          <label class="field" style="margin-top:10px;">
            <span class="labelText">Tolerance zones CSV</span>
            <textarea id="eccZones" rows="5">0,300,0.630
300,325,0.454
325,465,0.765
465,700,0.630</textarea>
          </label>
        </details>
      </div>
    </section>

    <!-- Existing Results -->
    <section class="card">
      <h2>Results</h2>

      <div id="summary" class="summary">No check run yet.</div>

      <div class="actions split">
        <button id="exportPdf" class="btn secondary" type="button">Export Results to PDF</button>
      </div>

      <div class="tableWrap">
        <table id="resultTable" aria-label="Compliance results">
          <thead>
            <tr>
              <th>Check</th>
              <th>Measured</th>
              <th>Allowed</th>
              <th>Status</th>
              <th>Reference</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>

      <div id="suggestions" class="suggestions">
        <h3>Engineering Adjustment Suggestions</h3>
        <ul id="suggestionList">
          <li>Run a compliance check to generate adjustment guidance.</li>
        </ul>
      </div>
    </section>

    <footer class="footnote">
      <strong>Important:</strong> Field aid only. Validate limits against the latest CMAA 70 / 74, TR-13, and project specs.
    </footer>

  </main>

  <script src="./app.js"></script>
  <script>
    if ("serviceWorker" in navigator) {
      window.addEventListener("load", () => {
        navigator.serviceWorker.register("./sw.js").catch(console.error);
      });
    }
  </script>
</body>
</html>
